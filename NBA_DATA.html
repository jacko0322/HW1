<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA DATA 2024-25 前100名球員數據儀表板</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            text-align: center;
            font-size: 2.8em;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 18px;
        }

        select {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        button {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(42, 82, 152, 0.3);
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            height: 350px;
            cursor: pointer;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .player-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            justify-content: center;
            align-items: center;
        }

        .card-back {
            background: rgba(255, 255, 255, 0.95);
            transform: rotateY(180deg);
            overflow-y: auto;
            position: relative;
        }

        .player-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .card-front .player-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card-front .player-team {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .card-front .hoopshype-rank {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .flip-hint-front {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            opacity: 0.7;
            animation: pulse 2s infinite;
            color: white;
        }

        .flip-hint-back {
            background: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 12px 15px;
            margin-top: auto;
            border-radius: 0 0 20px 20px;
            font-weight: bold;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            text-align: center;
            font-size: 0.9em;
            opacity: 0.8;
            animation: pulse 2s infinite;
            cursor: pointer;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .ranking-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            z-index: 10;
        }

        .top-10 {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }

        .top-25 {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: #333;
            box-shadow: 0 4px 15px rgba(192, 192, 192, 0.5);
        }

        .top-50 {
            background: linear-gradient(45deg, #cd7f32, #deb887);
            color: white;
            box-shadow: 0 4px 15px rgba(205, 127, 50, 0.5);
        }

        .card-back .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-back .player-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #1e3c72;
        }

        .card-back .player-position {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .player-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .info-label {
            color: #666;
            font-size: 0.9em;
        }

        .info-value {
            font-weight: bold;
            color: #333;
        }

        .advanced-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            flex-grow: 1;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stat-name {
            font-size: 0.8em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .data-source-info {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .file-upload-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #ccc;
        }

        .upload-button {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #212529;
            margin: 10px;
        }

        .player-photo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            color: white;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
        }

        .page-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #1e3c72;
            border: 2px solid #1e3c72;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 40px;
            text-align: center;
        }

        .page-btn:hover, .page-btn.active {
            background: #1e3c72;
            color: white;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .advanced-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>🏀 NBA DATA 2024-25 前100名球員</h1>
            <p class="subtitle">
                📊 完整統計數據 | HoopsHype 排名
            </p>
            
            <div class="controls">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="搜尋球員姓名...">
                    <span class="search-icon">🔍</span>
                </div>
                
                <select id="teamFilter">
                    <option value="">所有球隊</option>
                </select>
                
                <select id="rankFilter">
                    <option value="">所有排名</option>
                    <option value="1-10">前10名</option>
                    <option value="11-25">11-25名</option>
                    <option value="26-50">26-50名</option>
                    <option value="51-100">51-100名</option>
                </select>
                
                <select id="dataTypeSelect">
                    <option value="advanced">進階統計</option>
                    <option value="totals">基本統計</option>
                </select>
                
                <button onclick="clearFilters()">清除篩選</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 文件上傳區域 -->
        <div class="file-upload-section" id="fileUploadSection">
            <h3>📁 載入 NBA 數據文件</h3>
            <p style="margin: 10px 0; color: #666;">請選擇您的 nba-complete-data.json 文件</p>
            <input type="file" id="fileInput" accept=".json" style="margin: 10px 0;">
            <br>
            <button class="upload-button" onclick="loadJSONFile()">載入數據文件</button>
            <button class="upload-button" onclick="tryAutoLoad()">自動載入</button>
        </div>

        <!-- 數據來源說明 -->
        <div class="data-source-info" id="dataSourceInfo" style="display: none;">
            <strong>📁 數據來源:</strong> <span id="dataSourceText">正在載入...</span>
        </div>

        <div class="stats-summary" id="statsSummary" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalPlayers">0</div>
                <div class="stat-label">球員總數</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgAge">0</div>
                <div class="stat-label">平均年齡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTeams">0</div>
                <div class="stat-label">球隊數量</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgPER">0</div>
                <div class="stat-label">平均數據</div>
            </div>
        </div>

        <div id="loadingDiv" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            正在載入 NBA 球員數據...
        </div>

        <div id="errorDiv" class="error" style="display: none;"></div>

        <div class="pagination" id="pagination" style="display: none;"></div>

        <div class="players-grid" id="playersContainer"></div>

        <div class="pagination" id="paginationBottom" style="display: none;"></div>
    </div>

    <script>
        // 球員照片映射表 - 完整的100名球員照片路徑
        const playerPhotoMappings = {
            // 前10名 (超級巨星)
            "Nikola Jokic": "photos/nikola-jokic.jpg",
            "Luka Doncic": "photos/luka-doncic.jpg", 
            "Shai Gilgeous-Alexander": "photos/shai-gilgeous-alexander.jpg",
            "Giannis Antetokounmpo": "photos/giannis-antetokounmpo.jpg",
            "Joel Embiid": "photos/joel-embiid.jpg",
            "Jayson Tatum": "photos/jayson-tatum.jpg",
            "Anthony Edwards": "photos/anthony-edwards.jpg",
            "Jalen Brunson": "photos/jalen-brunson.jpg",
            "Anthony Davis": "photos/anthony-davis.jpg",
            "Victor Wembanyama": "photos/victor-wembanyama.jpg",
            
            // 11-25名 (All-Star級別)
            "Kevin Durant": "photos/kevin-durant.jpg",
            "Tyrese Haliburton": "photos/tyrese-haliburton.jpg",
            "LeBron James": "photos/lebron-james.jpg",
            "Stephen Curry": "photos/stephen-curry.jpg",
            "Tyrese Maxey": "photos/tyrese-maxey.jpg",
            "Devin Booker": "photos/devin-booker.jpg",
            "Donovan Mitchell": "photos/donovan-mitchell.jpg",
            "Jaylen Brown": "photos/jaylen-brown.jpg",
            "Ja Morant": "photos/ja-morant.jpg",
            "Domantas Sabonis": "photos/domantas-sabonis.jpg",
            "Damian Lillard": "photos/damian-lillard.jpg",
            "Zion Williamson": "photos/zion-williamson.jpg",
            "Paolo Banchero": "photos/paolo-banchero.jpg",
            "De'Aaron Fox": "photos/deaaron-fox.jpg",
            "Pascal Siakam": "photos/pascal-siakam.jpg",
            
            // 26-50名 (明星球員)
            "Kawhi Leonard": "photos/kawhi-leonard.jpg",
            "Paul George": "photos/paul-george.jpg",
            "Bam Adebayo": "photos/bam-adebayo.jpg",
            "Trae Young": "photos/trae-young.jpg",
            "Jimmy Butler": "photos/jimmy-butler.jpg",
            "Karl-Anthony Towns": "photos/karl-anthony-towns.jpg",
            "Rudy Gobert": "photos/rudy-gobert.jpg",
            "Kyrie Irving": "photos/kyrie-irving.jpg",
            "Lauri Markkanen": "photos/lauri-markkanen.jpg",
            "Scottie Barnes": "photos/scottie-barnes.jpg",
            "Jamal Murray": "photos/jamal-murray.jpg",
            "Cade Cunningham": "photos/cade-cunningham.jpg",
            "Julius Randle": "photos/julius-randle.jpg",
            "Alperen Sengun": "photos/alperen-sengun.jpg",
            "Chet Holmgren": "photos/chet-holmgren.jpg",
            "LaMelo Ball": "photos/lamelo-ball.jpg",
            "Jaren Jackson Jr": "photos/jaren-jackson-jr.jpg",
            "Jalen Williams": "photos/jalen-williams.jpg",
            "Kristaps Porzingis": "photos/kristaps-porzingis.jpg",
            "DeMar DeRozan": "photos/demar-derozan.jpg",
            "Brandon Ingram": "photos/brandon-ingram.jpg",
            "James Harden": "photos/james-harden.jpg",
            "Franz Wagner": "photos/franz-wagner.jpg",
            "Desmond Bane": "photos/desmond-bane.jpg",
            "Derrick White": "photos/derrick-white.jpg",
            
            // 51-75名 (優質先發)
            "Evan Mobley": "photos/evan-mobley.jpg",
            "Darius Garland": "photos/darius-garland.jpg",
            "Myles Turner": "photos/myles-turner.jpg",
            "Jrue Holiday": "photos/jrue-holiday.jpg",
            "Dejounte Murray": "photos/dejounte-murray.jpg",
            "Mikal Bridges": "photos/mikal-bridges.jpg",
            "OG Anunoby": "photos/og-anunoby.jpg",
            "Brandon Miller": "photos/brandon-miller.jpg",
            "Aaron Gordon": "photos/aaron-gordon.jpg",
            "Jarrett Allen": "photos/jarrett-allen.jpg",
            "Kyle Kuzma": "photos/kyle-kuzma.jpg",
            "Zach LaVine": "photos/zach-lavine.jpg",
            "Austin Reaves": "photos/austin-reaves.jpg",
            "Michael Porter Jr": "photos/michael-porter-jr.jpg",
            "Jalen Green": "photos/jalen-green.jpg",
            "Fred VanVleet": "photos/fred-vanvleet.jpg",
            "Miles Bridges": "photos/miles-bridges.jpg",
            "Jalen Johnson": "photos/jalen-johnson.jpg",
            "Tyler Herro": "photos/tyler-herro.jpg",
            "Coby White": "photos/coby-white.jpg",
            "CJ McCollum": "photos/cj-mccollum.jpg",
            "Josh Giddey": "photos/josh-giddey.jpg",
            "Bradley Beal": "photos/bradley-beal.jpg",
            "Trey Murphy": "photos/trey-murphy.jpg",
            "D'Angelo Russell": "photos/dangelo-russell.jpg",
            
            // 76-100名 (實力角色球員)
            "Devin Vassell": "photos/devin-vassell.jpg",
            "Immanuel Quickley": "photos/immanuel-quickley.jpg",
            "Herb Jones": "photos/herb-jones.jpg",
            "Jaden McDaniels": "photos/jaden-mcdaniels.jpg",
            "Jerami Grant": "photos/jerami-grant.jpg",
            "Josh Hart": "photos/josh-hart.jpg",
            "Keegan Murray": "photos/keegan-murray.jpg",
            "Jonathan Kuminga": "photos/jonathan-kuminga.jpg",
            "Malik Monk": "photos/malik-monk.jpg",
            "Cam Thomas": "photos/cam-thomas.jpg",
            "Donte DiVincenzo": "photos/donte-divincenzo.jpg",
            "Anfernee Simons": "photos/anfernee-simons.jpg",
            "Jabari Smith Jr": "photos/jabari-smith-jr.jpg",
            "Nikola Vucevic": "photos/nikola-vucevic.jpg",
            "Tobias Harris": "photos/tobias-harris.jpg",
            "Naz Reid": "photos/naz-reid.jpg",
            "Luguentz Dort": "photos/luguentz-dort.jpg",
            "Jalen Suggs": "photos/jalen-suggs.jpg",
            "PJ Washington": "photos/pj-washington.jpg",
            "RJ Barrett": "photos/rj-barrett.jpg",
            "Khris Middleton": "photos/khris-middleton.jpg",
            "Deandre Ayton": "photos/deandre-ayton.jpg",
            "Collin Sexton": "photos/collin-sexton.jpg",
            "Dereck Lively": "photos/dereck-lively.jpg",
            "Klay Thompson": "photos/klay-thompson.jpg"
        };

        // 全局變數
        let allPlayers = [];
        let filteredPlayers = [];
        let currentPage = 1;
        const playersPerPage = 12;
        let currentDataType = 'advanced';
        let staticData = null;

        // 可能的 JSON 文件路徑 (按優先級排序)
        const JSON_DATA_PATHS = [
            './nba-complete-data.json',
            'nba-complete-data.json',
            './data/nba-complete-data.json',
            './assets/nba-complete-data.json'
        ];

        // 頁面載入時初始化
        window.onload = function() {
            // 首先嘗試自動載入
            tryAutoLoad();
        };

        // 嘗試自動載入數據
        async function tryAutoLoad() {
            const loadingDiv = document.getElementById('loadingDiv');
            loadingDiv.style.display = 'block';
            
            console.log('🔍 嘗試自動載入數據文件...');
            
            for (const path of JSON_DATA_PATHS) {
                try {
                    console.log(`📁 測試路徑: ${path}`);
                    const response = await fetch(path);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`✅ 成功載入: ${path}`, data);
                        
                        processLoadedData(data, `自動載入: ${path}`);
                        return;
                    }
                } catch (error) {
                    console.log(`❌ 載入失敗: ${path} - ${error.message}`);
                }
            }
            
            // 自動載入失敗，顯示手動上傳選項
            loadingDiv.style.display = 'none';
            showFileUploadOption();
        }

        // 顯示文件上傳選項
        function showFileUploadOption() {
            document.getElementById('fileUploadSection').style.display = 'block';
            console.log('📂 請手動選擇 JSON 文件');
        }

        // 載入 JSON 文件（手動選擇）
        function loadJSONFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('❌ 請先選擇一個 JSON 文件');
                return;
            }
            
            if (!file.name.endsWith('.json')) {
                alert('❌ 請選擇 .json 文件');
                return;
            }
            
            const loadingDiv = document.getElementById('loadingDiv');
            loadingDiv.style.display = 'block';
            
            console.log(`📂 載入文件: ${file.name}`);
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    console.log('✅ JSON 文件載入成功', data);
                    
                    processLoadedData(data, `手動選擇: ${file.name}`);
                    
                } catch (error) {
                    console.error('❌ JSON 解析失敗:', error);
                    showError(`JSON 格式錯誤: ${error.message}`);
                }
            };
            
            reader.onerror = function() {
                console.error('❌ 文件讀取失敗');
                showError('文件讀取失敗');
            };
            
            reader.readAsText(file);
        }

        // 處理載入的數據
        function processLoadedData(data, sourcePath) {
            const loadingDiv = document.getElementById('loadingDiv');
            const fileUploadSection = document.getElementById('fileUploadSection');
            const dataSourceInfo = document.getElementById('dataSourceInfo');
            const dataSourceText = document.getElementById('dataSourceText');

            try {
                staticData = data;
                
                // 根據數據類型設置當前數據
                if (data.advanced && Array.isArray(data.advanced)) {
                    allPlayers = currentDataType === 'advanced' ? data.advanced : (data.totals || data.advanced);
                } else if (Array.isArray(data)) {
                    allPlayers = data;
                } else {
                    throw new Error('不支持的數據格式');
                }

                // 確保每個球員都有排名
                allPlayers.forEach((player, index) => {
                    if (!player.hoopsHypeRank) {
                        player.hoopsHypeRank = index + 1;
                    }
                });

                console.log(`📊 成功載入 ${allPlayers.length} 位球員的數據`);

                // 更新數據來源信息
                const downloadDate = data.metadata?.downloadDate || new Date().toISOString();
                dataSourceText.innerHTML = `${sourcePath} - 下載時間: ${new Date(downloadDate).toLocaleString()}`;
                
                // 更新界面
                updateFilterOptions();
                applyFilters();
                updateStatsSummary();

                // 隱藏載入相關元素，顯示數據
                loadingDiv.style.display = 'none';
                fileUploadSection.style.display = 'none';
                dataSourceInfo.style.display = 'block';
                document.getElementById('statsSummary').style.display = 'grid';

            } catch (error) {
                console.error('處理數據時出錯:', error);
                showError(`數據處理錯誤: ${error.message}`);
            }
        }

        // 顯示錯誤信息
        function showError(message) {
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `
                <h3>❌ 載入失敗</h3>
                <p>${message}</p>
                <button onclick="location.reload()" style="background: white; color: #ff6b6b; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                    🔄 重新載入頁面
                </button>
            `;
        }

        // 獲取球員照片URL
        function getPlayerPhotoUrl(playerName) {
            // 使用預設的照片映射
            if (playerPhotoMappings[playerName]) {
                return playerPhotoMappings[playerName];
            }
            
            // 嘗試自動生成路徑
            try {
                const formattedName = playerName.toLowerCase()
                    .replace(/[^a-z\s]/g, '')
                    .replace(/\s+/g, '-');
                
                return `photos/${formattedName}.jpg`;
            } catch (error) {
                return null;
            }
        }

        // 處理照片載入錯誤
        function handlePhotoError(imgElement, playerName) {
            console.log(`照片載入失敗: ${playerName}`);
            const placeholder = imgElement.nextElementSibling;
            if (placeholder) {
                imgElement.style.display = 'none';
                placeholder.style.display = 'flex';
            }
        }

        // 切換數據類型
        function switchDataType() {
            const newDataType = document.getElementById('dataTypeSelect').value;
            if (newDataType !== currentDataType && staticData) {
                currentDataType = newDataType;
                
                // 重新設置數據源
                if (staticData.advanced && staticData.totals) {
                    allPlayers = currentDataType === 'advanced' ? staticData.advanced : staticData.totals;
                } else if (Array.isArray(staticData)) {
                    allPlayers = staticData; // 單一數組格式
                }
                
                // 確保排名正確
                allPlayers.forEach((player, index) => {
                    if (!player.hoopsHypeRank) {
                        player.hoopsHypeRank = index + 1;
                    }
                });
                
                applyFilters();
                updateStatsSummary();
            }
        }

        // 更新篩選器選項
        function updateFilterOptions() {
            const teamFilter = document.getElementById('teamFilter');
            
            const teams = [...new Set(allPlayers.map(p => p.team))].sort();
            teamFilter.innerHTML = '<option value="">所有球隊</option>' + 
                teams.map(team => `<option value="${team}">${team}</option>`).join('');
        }

        // 應用篩選
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const teamFilter = document.getElementById('teamFilter').value;
            const rankFilter = document.getElementById('rankFilter').value;
            
            filteredPlayers = allPlayers.filter(player => {
                const matchesSearch = !searchTerm || 
                    player.playerName.toLowerCase().includes(searchTerm);
                const matchesTeam = !teamFilter || player.team === teamFilter;
                
                let matchesRank = true;
                if (rankFilter) {
                    const [min, max] = rankFilter.split('-').map(Number);
                    matchesRank = player.hoopsHypeRank >= min && player.hoopsHypeRank <= max;
                }
                
                return matchesSearch && matchesTeam && matchesRank;
            });
            
            currentPage = 1;
            displayPlayers();
        }

        // 顯示球員
        function displayPlayers() {
            const playersContainer = document.getElementById('playersContainer');
            const startIndex = (currentPage - 1) * playersPerPage;
            const endIndex = startIndex + playersPerPage;
            const playersToShow = filteredPlayers.slice(startIndex, endIndex);
            
            if (playersToShow.length === 0) {
                playersContainer.innerHTML = '<div class="no-results">找不到符合條件的球員</div>';
                document.getElementById('pagination').style.display = 'none';
                document.getElementById('paginationBottom').style.display = 'none';
                return;
            }
            
            playersContainer.innerHTML = playersToShow.map(player => createPlayerCard(player)).join('');
            updatePagination();
        }

        // 創建球員卡片
        function createPlayerCard(player) {
            const isAdvanced = currentDataType === 'advanced';
            const rank = player.hoopsHypeRank;
            
            let rankClass = '';
            if (rank <= 10) rankClass = 'top-10';
            else if (rank <= 25) rankClass = 'top-25';
            else if (rank <= 50) rankClass = 'top-50';
            
            return `
                <div class="player-card" onclick="flipCard(this)">
                    <div class="ranking-badge ${rankClass}">#${rank}</div>
                    <div class="card-inner">
                        <!-- 正面 -->
                        <div class="card-front">
                            <div class="player-photo">
                                ${getPlayerPhotoHtml(player.playerName)}
                            </div>
                            <div class="player-name">${player.playerName}</div>
                            <div class="player-team">${player.team}</div>
                            <div class="hoopshype-rank">RANK #${rank}</div>
                            <div class="flip-hint-front">點擊查看數據 ↻</div>
                        </div>
                        
                        <!-- 背面 -->
                        <div class="card-back">
                            <div class="player-header">
                                <div class="player-name">${player.playerName}</div>
                                <div class="player-position">${player.position || 'N/A'}</div>
                            </div>
                            
                            <div class="player-info">
                                <div class="info-item">
                                    <span class="info-label">球隊:</span>
                                    <span class="info-value">${player.team}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">排名:</span>
                                    <span class="info-value">#${rank}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">賽季:</span>
                                    <span class="info-value">${player.season || 2024}-${((player.season || 2024) + 1).toString().slice(-2)}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">年齡:</span>
                                    <span class="info-value">${player.age || 'N/A'}</span>
                                </div>
                            </div>
                            
                            <div class="advanced-stats">
                                ${isAdvanced ? `
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.per || 0).toFixed(1)}</div>
                                        <div class="stat-name">PER</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.tsPercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">TS%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.usagePercent || 0).toFixed(1)}%</div>
                                        <div class="stat-name">USG%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.winShares || 0).toFixed(1)}</div>
                                        <div class="stat-name">WS</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.vorp || 0).toFixed(1)}</div>
                                        <div class="stat-name">VORP</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.box || 0).toFixed(1)}</div>
                                        <div class="stat-name">BPM</div>
                                    </div>
                                ` : `
                                    <div class="stat-item">
                                        <div class="stat-value">${player.points || 0}</div>
                                        <div class="stat-name">得分</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${player.assists || 0}</div>
                                        <div class="stat-name">助攻</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${player.totalRb || player.rebounds || 0}</div>
                                        <div class="stat-name">籃板</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.fieldPercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">投籃%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.threePercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">三分%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.steals || 0).toFixed(1)}</div>
                                        <div class="stat-name">抄截</div>
                                    </div>
                                `}
                            </div>
                            
                            <div class="flip-hint-back">點擊返回 ↻</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成球員照片HTML
        function getPlayerPhotoHtml(playerName) {
            const photoUrl = getPlayerPhotoUrl(playerName);
            
            if (photoUrl) {
                return `
                    <img src="${photoUrl}" 
                         alt="${playerName}" 
                         onerror="handlePhotoError(this, '${playerName}')"
                         style="display: block;">
                    <div class="photo-placeholder" style="display: none;">🏀</div>
                `;
            } else {
                return `<div class="photo-placeholder">🏀</div>`;
            }
        }

        // 卡片翻轉功能
        function flipCard(cardElement) {
            cardElement.classList.toggle('flipped');
        }

        // 更新統計摘要
        function updateStatsSummary() {
            if (filteredPlayers.length === 0) return;
            
            const totalPlayers = filteredPlayers.length;
            const avgAge = (filteredPlayers.reduce((sum, p) => sum + (p.age || 0), 0) / totalPlayers).toFixed(1);
            const totalTeams = new Set(filteredPlayers.map(p => p.team)).size;
            
            let avgStat = 0;
            let statLabel = '';
            
            if (currentDataType === 'advanced') {
                avgStat = (filteredPlayers.reduce((sum, p) => sum + (p.per || 0), 0) / totalPlayers).toFixed(1);
                statLabel = '平均PER';
            } else {
                avgStat = (filteredPlayers.reduce((sum, p) => sum + (p.points || 0), 0) / totalPlayers).toFixed(1);
                statLabel = '平均得分';
            }
            
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('avgAge').textContent = avgAge;
            document.getElementById('totalTeams').textContent = totalTeams;
            document.getElementById('avgPER').textContent = avgStat;
            
            document.querySelector('#statsSummary .stat-card:last-child .stat-label').textContent = statLabel;
        }

        // 更新分頁
        function updatePagination() {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            const pagination = document.getElementById('pagination');
            const paginationBottom = document.getElementById('paginationBottom');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                paginationBottom.style.display = 'none';
                return;
            }
            
            const paginationHTML = createPaginationHTML(totalPages);
            pagination.innerHTML = paginationHTML;
            paginationBottom.innerHTML = paginationHTML;
            pagination.style.display = 'flex';
            paginationBottom.style.display = 'flex';
        }

        function createPaginationHTML(totalPages) {
            let html = `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‹</button>`;
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span class="page-btn">...</span>`;
                }
            }
            
            html += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>›</button>`;
            return html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayPlayers();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // 清除篩選
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('teamFilter').value = '';
            document.getElementById('rankFilter').value = '';
            applyFilters();
        }

        // 事件監聽器
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('teamFilter').addEventListener('change', applyFilters);
            document.getElementById('rankFilter').addEventListener('change', applyFilters);
            document.getElementById('dataTypeSelect').addEventListener('change', switchDataType);
        });
    </script>
</body>
</html>